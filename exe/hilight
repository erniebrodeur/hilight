#!/usr/bin/env ruby

require "hilight"
require 'term/ansicolor'
require 'open3'

include Hilight #rubocop:disable all

filters = Filters[[
  Filter["rspec", Patterns[[
    Pattern[/(?<green>\d+) examples, (?<red>\d+) failures?, (?<yellow>\d+) pending/, '\k<green> examples, \k<red> failures, \k<yellow> pending'],
    Pattern[/(?<blue>\d+\.\d+)/, '\k<blue>'],
    Pattern[/\"(?<green>.*?)\"|\'(?<green>.*?)\'/, '\k<green>'],
    Pattern[/# (?<red>.*):(?<yellow>\d+)/, '\k<red>:\k<yellow>']
  ]]],
  Filter[/-h|--help|help/, Patterns[[
    Pattern[/(?<yellow>\B-{1,2}[\w-]+)|(?<blue>[\[\]\(\)\{\}\<\>])|(?<green>["'].*?["'])/, '\k<yellow>\k<blue>\k<green>']
  ]]],
  Filter["git",   Patterns[[Pattern[/(?<green>'.*')|(?<blue>".*")/, '\k<green>\k<blue>']]]],
  Filter["ruby",  Patterns[[
    Pattern[/(.*from |)(?<red>.*):(?<blue>\d+)(?::in )(?<yellow>`.*')/, '\k<red>\k<blue>\k<yellow>']
  ]]],
  Filter["default", Patterns[[
    Pattern[/(?<green>'.*')|(?<blue>".*")/, '\k<green>\k<blue>']
  ]]]
]]

abort 'hilight <cmd>' unless ARGV.any?

filters.exec ARGV.join(' ')
